name: Playwright Tests mit Pages
on:
  push:
    branches: [ main ]
  workflow_dispatch:

# Permissions fÃ¼r GitHub Pages
permissions:
  contents:  read
  pages: write
  id-token: write

jobs:
  test:
    timeout-minutes: 60
    runs-on: ubuntu-latest
    
    steps: 
    - name: Checkout Repository
      uses: actions/checkout@v4
    
    - name: Setup Node. js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
    
    - name:  Install Dependencies
      run: npm install
    
    - name: Install Playwright Browsers
      run:  npx playwright install --with-deps chromium
    
    - name:  Run Playwright Tests
      run:  npx playwright test --project=chromium
      continue-on-error: true
    
    - name: Create Screenshots Gallery
      run: |
        mkdir -p public
        cat > public/index.html << 'EOF'
        <!DOCTYPE html>
        <html lang="de">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Playwright Screenshots Gallery</title>
            <style>
                * {
                    margin: 0;
                    padding: 0;
                    box-sizing:  border-box;
                }
                body {
                    font-family:  -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
                    background:  linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    padding: 20px;
                    min-height: 100vh;
                }
                .container {
                    max-width: 1400px;
                    margin: 0 auto;
                }
                h1 {
                    color: white;
                    text-align:  center;
                    margin-bottom: 40px;
                    font-size: 3em;
                    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
                }
                .gallery {
                    display: grid;
                    grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
                    gap: 30px;
                }
                .screenshot-card {
                    background:  white;
                    border-radius: 15px;
                    overflow: hidden;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                    transition: transform 0.3s ease, box-shadow 0.3s ease;
                }
                . screenshot-card:hover {
                    transform: translateY(-10px);
                    box-shadow: 0 20px 40px rgba(0,0,0,0.4);
                }
                .screenshot-card img {
                    width: 100%;
                    height: auto;
                    display: block;
                    cursor: pointer;
                }
                .screenshot-card h3 {
                    padding: 20px;
                    background: #f8f9fa;
                    color: #333;
                    font-size: 1.2em;
                }
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1000;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0,0,0,0.9);
                }
                .modal-content {
                    margin: auto;
                    display: block;
                    max-width: 90%;
                    max-height: 90%;
                    position: relative;
                    top: 50%;
                    transform: translateY(-50%);
                }
                .close {
                    position: absolute;
                    top:  20px;
                    right: 40px;
                    color: white;
                    font-size: 40px;
                    font-weight: bold;
                    cursor: pointer;
                }
                .report-link {
                    text-align: center;
                    margin-top: 40px;
                }
                .report-link a {
                    display: inline-block;
                    padding: 15px 30px;
                    background: white;
                    color: #667eea;
                    text-decoration: none;
                    border-radius: 25px;
                    font-weight: bold;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                    transition: all 0.3s ease;
                }
                . report-link a:hover {
                    transform: scale(1.05);
                    box-shadow: 0 8px 20px rgba(0,0,0,0.3);
                }
            </style>
        </head>
        <body>
            <div class="container">
                <h1>ðŸ“¸ Playwright Screenshots Gallery</h1>
                <div class="gallery" id="gallery"></div>
                <div class="report-link">
                    <a href="playwright-report/index.html">ðŸ“Š VollstÃ¤ndiger Test Report</a>
                </div>
            </div>
            
            <div id="modal" class="modal">
                <span class="close">&times;</span>
                <img class="modal-content" id="modal-img">
            </div>

            <script>
                // Screenshots dynamisch laden
                const screenshots = [
                    { name: 'Homepage Full', path: 'screenshots/homepage-full.png' },
                    { name: 'Example Page', path: 'screenshots/example-page.png' },
                    { name: 'GitHub Full', path: 'screenshots/github-full.png' },
                    { name: 'GitHub Header', path: 'screenshots/github-header.png' }
                ];

                const gallery = document.getElementById('gallery');
                
                screenshots.forEach(screenshot => {
                    const card = document. createElement('div');
                    card.className = 'screenshot-card';
                    card.innerHTML = \`
                        <img src="\${screenshot.path}" alt="\${screenshot.name}" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22400%22 height=%22300%22><rect fill=%22%23ddd%22 width=%22400%22 height=%22300%22/><text x=%2250%%22 y=%2250%%22 font-size=%2220%22 text-anchor=%22middle%22 fill=%22%23999%22>Screenshot nicht verfÃ¼gbar</text></svg>'">
                        <h3>\${screenshot.name}</h3>
                    \`;
                    gallery.appendChild(card);
                });

                // Modal fÃ¼r groÃŸe Ansicht
                const modal = document. getElementById('modal');
                const modalImg = document.getElementById('modal-img');
                const closeBtn = document.querySelector('.close');

                gallery.addEventListener('click', (e) => {
                    if (e.target. tagName === 'IMG') {
                        modal.style.display = 'block';
                        modalImg.src = e.target.src;
                    }
                });

                closeBtn.onclick = () => modal.style.display = 'none';
                modal.onclick = (e) => {
                    if (e.target === modal) modal.style.display = 'none';
                };
            </script>
        </body>
        </html>
        EOF
    
    - name: Copy Screenshots to Public
      run: |
        mkdir -p public/screenshots
        if [ -d "test-results" ]; then
          find test-results -name "*.png" -exec cp {} public/screenshots/ \;
        fi
    
    - name: Copy Playwright Report
      run: |
        if [ -d "playwright-report" ]; then
          cp -r playwright-report public/
        fi
    
    - name: Setup Pages
      uses: actions/configure-pages@v4
    
    - name: Upload artifact
      uses: actions/upload-pages-artifact@v3
      with:
        path: 'public'
    
    - name: Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v4
